<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Profile ‚Äì SecretShare</title>

  <!-- ====== basic, self-contained styles ====== -->
  <style>
  *,*::before,*::after{box-sizing:border-box}
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#fff;color:#222}
  .wrapper{max-width:960px;margin:0 auto;padding:20px}

  /* top nav */
  nav{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #ddd;padding:10px 0 14px}
  nav .links a{margin-right:18px;text-decoration:none;font-weight:bold;color:#444}
  nav .links a.active{color:#000;border-bottom:2px solid #000;padding-bottom:2px}
  nav button#logout{background:#f44336;color:#fff;border:none;padding:6px 14px;border-radius:4px;cursor:pointer}

  /* profile header */
  .profile{display:flex;align-items:center;margin:32px 0 18px}
  .avatar{width:120px;height:120px;border-radius:50%;background:#bbb;color:#fff;font-size:64px;
          display:flex;align-items:center;justify-content:center;margin-right:24px}
  .profile h1{margin:0;font-size:28px}
  .profile p{margin:5px 0;color:#666}
  .stats{display:flex;gap:34px;margin-top:12px}
  .stats div{text-align:center}
  .stats span{display:block;font-weight:bold;font-size:18px}

  /* tabs */
  .tabs{display:flex;gap:10px;border-top:1px solid #ddd;margin-bottom:22px}
  .tabs button{flex:1;padding:12px 0;border:none;font-weight:bold;background:#f5f5f5;cursor:pointer;border-radius:6px 6px 0 0}
  .tabs button.active{background:#fff;border-bottom:3px solid #000}

  /* panels */
  .panel{display:none}
  .panel.active{display:block}

  /* video grid */
  .grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fill,minmax(170px,1fr))}
  .thumb{position:relative;aspect-ratio:1/1;border-radius:6px;overflow:hidden;cursor:pointer}
  .thumb img,.thumb video{width:100%;height:100%;object-fit:cover;transition:transform .3s}
  .thumb:hover img,.thumb:hover video{transform:scale(1.05)}
  .info{position:absolute;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);color:#fff;font-size:12px;
        display:flex;justify-content:space-between;align-items:center;padding:4px 6px}
  .info .title{font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:70%}

  /* form */
  form{max-width:600px}
  label{display:block;margin-top:16px;font-weight:bold}
  input,textarea{width:100%;margin-top:6px;padding:8px;border:1px solid #ccc;border-radius:4px;font-size:14px}
  textarea{resize:vertical;height:80px}
  button.submit{margin-top:22px;padding:10px 22px;background:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer}
  .msg{margin-top:12px;font-weight:bold}
  </style>
</head>

<body>
<div class="wrapper">
  <!-- NAVIGATION -->
  <nav>
    <div class="links">
      <a href="home.html">üè† Feed</a>
      <a href="profile.html" class="active">üë§ Profile</a>
      <a href="createone.html">‚ûï Share</a>
    </div>
    <button id="logout">Sign out</button>
  </nav>

  <!-- PROFILE HEADER -->
  <section class="profile">
    <div id="avatar" class="avatar">U</div>
    <div>
      <h1 id="name">Loading‚Ä¶</h1>
      <p id="email">Loading‚Ä¶</p>
      <div class="stats">
        <div><span id="v-count">0</span>Videos</div>
        <div><span id="foll-count">0</span>Followers</div>
        <div><span id="wing-count">0</span>Following</div>
        <div><span id="view-count">0</span>Views</div>
      </div>
    </div>
  </section>

  <!-- TABS -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="posts">Posts</button>
    <button class="tab-btn"        data-tab="edit">Edit Profile</button>
  </div>

  <!-- POSTS PANEL -->
  <section id="posts" class="panel active">
    <div id="grid" class="grid"></div>
  </section>

  <!-- EDIT PANEL -->
  <section id="edit" class="panel">
    <form id="profile-form">
      <label>Username <input id="username" required pattern="\\w+" minlength="3" maxlength="30"></label>
      <label>Full name <input id="fullname"></label>
      <label>Bio <textarea id="bio" maxlength="500"></textarea></label>
      <label>Instagram <input id="instagram" maxlength="50"></label>
      <label>Website <input id="website" type="url"></label>
      <button type="submit" class="submit">Update profile</button>
    </form>
    <div id="msg" class="msg"></div>
  </section>
</div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const sb = supabase.createClient('YOUR_SUPABASE_URL','YOUR_SUPABASE_ANON_KEY');
let user=null;

/* ---------- load profile ---------- */
async function loadProfile(){
  const {data:{user:u}}=await sb.auth.getUser();
  if(!u){location='login.html';return;}
  user=u;
  avatar.textContent=u.email[0].toUpperCase();

  const {data:p}=await sb.from('profiles').select('*').eq('id',u.id).single();
  if(p){
    name.textContent=p.username||'User';
    email.textContent=u.email||'';
    v-count.textContent=p.videos_count||0;
    foll-count.textContent=p.followers_count||0;
    wing-count.textContent=p.following_count||0;
    view-count.textContent=p.total_views||0;

    username.value=p.username||'';
    fullname.value=p.full_name||'';
    bio.value=p.bio||'';
    instagram.value=p.instagram_handle||'';
    website.value=p.website_url||'';
  }
  loadVideos();
}

/* ---------- load videos ---------- */
async function loadVideos(){
  const {data, error}=await sb.from('videos')
    .select('id,title,video_url,thumbnail_url')
    .eq('user_id',user.id).eq('is_published',true)
    .order('created_at',{ascending:false});
  if(error){console.error(error);return;}

  grid.innerHTML=data.map(v=>{
    const media=v.thumbnail_url
      ? `<img src="${v.thumbnail_url}" alt="${v.title}">`
      : `<video muted preload="metadata" src="${v.video_url}"></video>`;
    return `
      <a href="watch.html?id=${v.id}" class="thumb" title="${v.title}">
        ${media}
        <div class="info">
          <span class="title">${v.title}</span>
        </div>
      </a>`;
  }).join('');
}

/* ---------- update profile ---------- */
profile-form.onsubmit=async e=>{
  e.preventDefault();
  const {error}=await sb.from('profiles').update({
    username:username.value,
    full_name:fullname.value,
    bio:bio.value,
    instagram_handle:instagram.value,
    website_url:website.value,
    updated_at:new Date().toISOString()
  }).eq('id',user.id);
  msg.textContent=error?'Update failed':'Profile updated ‚úî';
};

/* ---------- tab switching ---------- */
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const tab=btn.dataset.tab;
    document.querySelectorAll('.panel').forEach(p=>p.classList.toggle('active',p.id===tab));
    if(tab==='posts') loadVideos();
  };
});

/* ---------- logout ---------- */
logout.onclick=async()=>{await sb.auth.signOut();location='/';};

/* ---------- init ---------- */
document.addEventListener('DOMContentLoaded',loadProfile);
</script>
</body>
</html>
