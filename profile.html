<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Profile — SecretShare</title>

  <!-- main site styles -->
  <link rel="stylesheet" href="styles.css">

  <!-- IG-style extras (copy into styles.css if preferred) -->
  <style>
  /* ——— PROFILE HEADER ——— */
  .profile-card{display:flex;gap:32px;align-items:center;flex-wrap:wrap}
  .profile-avatar .user-avatar.large{font-size:46px;width:116px;height:116px}
  .profile-info h2{font:600 20px/1.3 'Inter',sans-serif;margin-bottom:6px}
  .profile-stats{display:flex;gap:24px;margin-top:8px}
  .profile-stats .stat{text-align:center}
  .profile-stats .stat-number{font:600 18px}

  /* ——— NAV TABS ——— */
  .profile-nav{margin:34px 0 14px;display:flex;gap:12px}
  .tab-btn{
    flex:1;padding:8px 0;border:none;cursor:pointer;
    font:600 14px/1 'Inter',sans-serif;letter-spacing:.4px;
    background:#f5f5f5;border-radius:6px;transition:background .2s}
  .tab-btn.active,.tab-btn:hover{background:#e0e0e0}

  /* ——— POSTS GRID (3-col responsive) ——— */
  .posts-grid{display:grid;gap:6px;
    grid-template-columns:repeat(auto-fill,minmax(122px,1fr))}
  .post-thumb{position:relative;overflow:hidden;aspect-ratio:1/1}
  .post-thumb img,.post-thumb video{width:100%;height:100%;object-fit:cover;
    transition:transform .25s}
  .post-thumb:hover img{transform:scale(1.05)}

  /* ——— PANEL VISIBILITY ——— */
  .tab-panel.hidden{display:none}
  </style>
</head>

<body class="dashboard-body">
  <div class="dashboard-container">
    <!-- Navigation --------------------------------------------------->
    <nav class="dashboard-nav">
      <div class="nav-brand"><h3>🔒 SecretShare</h3></div>

      <div class="nav-links">
        <a href="home.html"     class="nav-link"><span class="nav-icon">🏠</span>Feed</a>
        <a href="profile.html"  class="nav-link active"><span class="nav-icon">👤</span>Profile</a>
        <a href="createone.html"class="nav-link"><span class="nav-icon">➕</span>Share Secret</a>
      </div>

      <button class="btn secondary logout-btn" id="logout">Sign out</button>
    </nav>

    <!-- Main ---------------------------------------------------------->
    <main class="dashboard-main">
      <div class="profile-container">
        <!-- header -------------------------------------------------->
        <div class="page-header">
          <h1>Your profile</h1>
          <p class="page-subtitle">Manage your account, see your posts</p>
        </div>

        <!-- overview card ----------------------------------------->
        <div class="profile-overview">
          <div class="profile-card">
            <div class="profile-avatar">
              <div class="user-avatar large" id="profile-avatar">👤</div>
              <button class="btn secondary small">Change avatar</button>
            </div>

            <div class="profile-info">
              <h2 id="profile-display-name">Loading…</h2>
              <p id="profile-display-email">Loading…</p>

              <div class="profile-stats">
                <div class="stat"><span class="stat-number" id="videos-count">0</span><span class="stat-label">Videos</span></div>
                <div class="stat"><span class="stat-number" id="followers-count">0</span><span class="stat-label">Followers</span></div>
                <div class="stat"><span class="stat-number" id="following-count">0</span><span class="stat-label">Following</span></div>
                <div class="stat"><span class="stat-number" id="total-views">0</span><span class="stat-label">Total views</span></div>
              </div>
            </div>
          </div>
        </div>

        <!-- IG-style nav tabs ------------------------------------->
        <div class="profile-nav">
          <button class="tab-btn active" data-tab="posts">POSTS</button>
          <button class="tab-btn"        data-tab="edit">EDIT PROFILE</button>
        </div>

        <!-- POSTS GRID (default visible) -------------------------->
        <section id="posts-section" class="tab-panel">
          <div id="posts-grid" class="posts-grid">
            <!-- thumbnails injected by JS -->
          </div>
        </section>

        <!-- SETTINGS (hidden until tab click) --------------------->
        <section id="edit-section" class="tab-panel hidden">
          <div class="settings-container">
            <!-- ◄--- everything you already had (basic info, security, privacy) –--► -->
            … (keep your entire existing settings markup here; omitted for brevity) …
          </div>
        </section>

        <!-- messages -->
        <div id="profile-message" class="message"></div>
      </div>
    </main>
  </div>

  <!-- Scripts -------------------------------------------------------->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
  <script src="config.js"></script>
  <script src="dashboard.js"></script>

  <!-- IG-style behaviour (add to dashboard.js if you prefer) -->
  <script>
  // ─── TAB SWITCHING ───────────────────────────────────────
  document.querySelectorAll('.tab-btn').forEach(btn=>{
    btn.addEventListener('click',e=>{
      document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');

      const tab = btn.dataset.tab;          // 'posts' | 'edit'
      document.getElementById('posts-section').classList.toggle('hidden', tab!=='posts');
      document.getElementById('edit-section' ).classList.toggle('hidden', tab!=='edit');
      if(tab==='posts') loadMyPosts();      // refresh grid each time
    });
  });

  // ─── LOAD USER POSTS INTO GRID ──────────────────────────
  async function loadMyPosts(){
    const grid = document.getElementById('posts-grid');
    if(!grid || !window.sb || !window.currentUser) return;

    const { data: vids, error } = await sb
          .from('videos')
          .select('id,thumbnail_url')
          .eq('user_id', currentUser.id)
          .order('created_at',{ascending:false});

    if(error){ console.error(error); return; }

    grid.innerHTML = vids.map(v=>`
      <a href="video.html?id=${v.id}" class="post-thumb">
        <img src="${v.thumbnail_url ?? 'fallback.jpg'}" alt="">
      </a>
    `).join('');
  }

  // load grid on first visit
  document.addEventListener('DOMContentLoaded', loadMyPosts);
  </script>
</body>
</html>
